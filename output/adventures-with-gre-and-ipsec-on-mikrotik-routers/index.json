{
  "schema_name": "DoclingDocument",
  "version": "1.4.0",
  "name": "myfile",
  "origin": {
    "mimetype": "text/markdown",
    "binary_hash": 14980217574295158204,
    "filename": "myfile.md"
  },
  "furniture": {
    "self_ref": "#/furniture",
    "children": [],
    "content_layer": "furniture",
    "name": "_root_",
    "label": "unspecified"
  },
  "body": {
    "self_ref": "#/body",
    "children": [
      {
        "$ref": "#/pictures/0"
      },
      {
        "$ref": "#/texts/0"
      },
      {
        "$ref": "#/texts/1"
      },
      {
        "$ref": "#/texts/2"
      },
      {
        "$ref": "#/texts/3"
      },
      {
        "$ref": "#/texts/4"
      },
      {
        "$ref": "#/texts/5"
      },
      {
        "$ref": "#/groups/0"
      },
      {
        "$ref": "#/texts/8"
      },
      {
        "$ref": "#/texts/9"
      },
      {
        "$ref": "#/texts/10"
      },
      {
        "$ref": "#/texts/11"
      },
      {
        "$ref": "#/texts/12"
      },
      {
        "$ref": "#/texts/13"
      },
      {
        "$ref": "#/texts/14"
      },
      {
        "$ref": "#/texts/15"
      },
      {
        "$ref": "#/texts/16"
      },
      {
        "$ref": "#/texts/17"
      },
      {
        "$ref": "#/texts/18"
      },
      {
        "$ref": "#/texts/19"
      },
      {
        "$ref": "#/texts/20"
      },
      {
        "$ref": "#/texts/21"
      },
      {
        "$ref": "#/texts/22"
      },
      {
        "$ref": "#/texts/23"
      },
      {
        "$ref": "#/texts/24"
      },
      {
        "$ref": "#/texts/25"
      },
      {
        "$ref": "#/texts/26"
      },
      {
        "$ref": "#/texts/27"
      },
      {
        "$ref": "#/texts/28"
      },
      {
        "$ref": "#/texts/29"
      },
      {
        "$ref": "#/texts/30"
      },
      {
        "$ref": "#/texts/31"
      },
      {
        "$ref": "#/texts/32"
      },
      {
        "$ref": "#/texts/33"
      },
      {
        "$ref": "#/texts/34"
      },
      {
        "$ref": "#/texts/35"
      },
      {
        "$ref": "#/texts/36"
      },
      {
        "$ref": "#/texts/37"
      },
      {
        "$ref": "#/texts/38"
      },
      {
        "$ref": "#/groups/1"
      },
      {
        "$ref": "#/texts/42"
      },
      {
        "$ref": "#/texts/43"
      },
      {
        "$ref": "#/texts/44"
      },
      {
        "$ref": "#/texts/45"
      },
      {
        "$ref": "#/texts/46"
      },
      {
        "$ref": "#/texts/47"
      },
      {
        "$ref": "#/texts/48"
      },
      {
        "$ref": "#/texts/49"
      },
      {
        "$ref": "#/texts/50"
      },
      {
        "$ref": "#/texts/51"
      },
      {
        "$ref": "#/texts/52"
      },
      {
        "$ref": "#/texts/53"
      },
      {
        "$ref": "#/texts/54"
      },
      {
        "$ref": "#/texts/55"
      },
      {
        "$ref": "#/texts/56"
      },
      {
        "$ref": "#/texts/57"
      },
      {
        "$ref": "#/texts/58"
      },
      {
        "$ref": "#/texts/59"
      },
      {
        "$ref": "#/texts/60"
      },
      {
        "$ref": "#/texts/61"
      },
      {
        "$ref": "#/texts/62"
      },
      {
        "$ref": "#/texts/63"
      },
      {
        "$ref": "#/texts/64"
      },
      {
        "$ref": "#/texts/65"
      },
      {
        "$ref": "#/texts/66"
      },
      {
        "$ref": "#/texts/67"
      },
      {
        "$ref": "#/texts/68"
      },
      {
        "$ref": "#/texts/69"
      },
      {
        "$ref": "#/texts/70"
      },
      {
        "$ref": "#/texts/71"
      },
      {
        "$ref": "#/pictures/1"
      },
      {
        "$ref": "#/texts/72"
      },
      {
        "$ref": "#/texts/73"
      },
      {
        "$ref": "#/texts/74"
      },
      {
        "$ref": "#/texts/75"
      }
    ],
    "content_layer": "body",
    "name": "_root_",
    "label": "unspecified"
  },
  "groups": [
    {
      "self_ref": "#/groups/0",
      "parent": {
        "$ref": "#/body"
      },
      "children": [
        {
          "$ref": "#/texts/6"
        },
        {
          "$ref": "#/texts/7"
        }
      ],
      "content_layer": "body",
      "name": "list",
      "label": "list"
    },
    {
      "self_ref": "#/groups/1",
      "parent": {
        "$ref": "#/body"
      },
      "children": [
        {
          "$ref": "#/texts/39"
        },
        {
          "$ref": "#/texts/40"
        },
        {
          "$ref": "#/texts/41"
        }
      ],
      "content_layer": "body",
      "name": "list",
      "label": "list"
    }
  ],
  "texts": [
    {
      "self_ref": "#/texts/0",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "1",
      "text": "1"
    },
    {
      "self_ref": "#/texts/1",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I recently picked up a  RB850GX2  from my favorite Mikrotik retailer,  r0c-n0c . It's a dual-core PowerPC board with five ethernet ports and some decent performance for the price.",
      "text": "I recently picked up a  RB850GX2  from my favorite Mikrotik retailer,  r0c-n0c . It's a dual-core PowerPC board with five ethernet ports and some decent performance for the price."
    },
    {
      "self_ref": "#/texts/2",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I still have the RB493G in a colocation and I usually connect my home and the colo via OpenVPN or IPSec. Networking is not one of my best skills and I'm always looking to learn more about it when I can. I decided to try out a GRE tunnel on top of IPSec this time around. Combining GRE and IPSec allows you to simplify connectivity between two network segments through an encrypted tunnel.",
      "text": "I still have the RB493G in a colocation and I usually connect my home and the colo via OpenVPN or IPSec. Networking is not one of my best skills and I'm always looking to learn more about it when I can. I decided to try out a GRE tunnel on top of IPSec this time around. Combining GRE and IPSec allows you to simplify connectivity between two network segments through an encrypted tunnel."
    },
    {
      "self_ref": "#/texts/3",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "The Setup",
      "text": "The Setup",
      "level": 1
    },
    {
      "self_ref": "#/texts/4",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "The LAN in my colo and at home is fairly simple: a /24 of RFC1918 space behind a Mikrotik doing NAT. My goal was to get a tunnel up between both environments so that I could reach devices behind my colo firewall from home and vice versa. I do plenty of ssh back and forth along with backups from time to time.",
      "text": "The LAN in my colo and at home is fairly simple: a /24 of RFC1918 space behind a Mikrotik doing NAT. My goal was to get a tunnel up between both environments so that I could reach devices behind my colo firewall from home and vice versa. I do plenty of ssh back and forth along with backups from time to time."
    },
    {
      "self_ref": "#/texts/5",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "In this example, here's the current network configuration:",
      "text": "In this example, here's the current network configuration:"
    },
    {
      "self_ref": "#/texts/6",
      "parent": {
        "$ref": "#/groups/0"
      },
      "children": [],
      "content_layer": "body",
      "label": "list_item",
      "prov": [],
      "orig": "Home: 192.168.50.0/24 on the LAN, 1.1.1.1 as the public IP",
      "text": "Home: 192.168.50.0/24 on the LAN, 1.1.1.1 as the public IP",
      "enumerated": false,
      "marker": "-"
    },
    {
      "self_ref": "#/texts/7",
      "parent": {
        "$ref": "#/groups/0"
      },
      "children": [],
      "content_layer": "body",
      "label": "list_item",
      "prov": [],
      "orig": "Colo: 192.168.150.0/24 on the LAN, 2.2.2.2 as the public IP",
      "text": "Colo: 192.168.150.0/24 on the LAN, 2.2.2.2 as the public IP",
      "enumerated": false,
      "marker": "-"
    },
    {
      "self_ref": "#/texts/8",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I want devices on 192.168.50.0/24 to talk to 192.168.150.0/24 and vice versa. Let's get the GRE tunnel up first.",
      "text": "I want devices on 192.168.50.0/24 to talk to 192.168.150.0/24 and vice versa. Let's get the GRE tunnel up first."
    },
    {
      "self_ref": "#/texts/9",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "GRE",
      "text": "GRE",
      "level": 1
    },
    {
      "self_ref": "#/texts/10",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Plain GRE tunnels aren't encrypted, but I prefer to set them up first to test connectivity prior to adding IPSec into the mix. IPSec can be a challenge to configure the first time around.",
      "text": "Plain GRE tunnels aren't encrypted, but I prefer to set them up first to test connectivity prior to adding IPSec into the mix. IPSec can be a challenge to configure the first time around."
    },
    {
      "self_ref": "#/texts/11",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I'll first create a GRE interface at home:",
      "text": "I'll first create a GRE interface at home:"
    },
    {
      "self_ref": "#/texts/12",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/interface gre\nadd !keepalive local-address=1.1.1.1 name=home-to-colo remote-address=2.2.2.2",
      "text": "/interface gre\nadd !keepalive local-address=1.1.1.1 name=home-to-colo remote-address=2.2.2.2",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/13",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We'll do the same on the colo router:",
      "text": "We'll do the same on the colo router:"
    },
    {
      "self_ref": "#/texts/14",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/interface gre\nadd !keepalive local-address=2.2.2.2 name=colo-to-home remote-address=1.1.1.1",
      "text": "/interface gre\nadd !keepalive local-address=2.2.2.2 name=colo-to-home remote-address=1.1.1.1",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/15",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "You can check to see if the GRE tunnel is running from either router:",
      "text": "You can check to see if the GRE tunnel is running from either router:"
    },
    {
      "self_ref": "#/texts/16",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/interface gre print",
      "text": "/interface gre print",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/17",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Look for the  R  in the flags column.",
      "text": "Look for the  R  in the flags column."
    },
    {
      "self_ref": "#/texts/18",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "If you've made it this far, you now have a GRE tunnel configured but we can't pass any traffic across it yet. We need to add some IP's to both sides and configure some routes.",
      "text": "If you've made it this far, you now have a GRE tunnel configured but we can't pass any traffic across it yet. We need to add some IP's to both sides and configure some routes."
    },
    {
      "self_ref": "#/texts/19",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "IP's and Routes",
      "text": "IP's and Routes",
      "level": 1
    },
    {
      "self_ref": "#/texts/20",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "You have some freedom here to choose the IP addresses for both ends of your tunnel but don't choose anything that interferes with your current LAN IP addresses. In my case, I'll choose 10.10.10.1/30 and 10.10.10.2/30 for both ends of the tunnel.",
      "text": "You have some freedom here to choose the IP addresses for both ends of your tunnel but don't choose anything that interferes with your current LAN IP addresses. In my case, I'll choose 10.10.10.1/30 and 10.10.10.2/30 for both ends of the tunnel."
    },
    {
      "self_ref": "#/texts/21",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I'll give the 10.10.10.2 address to the home firewall:",
      "text": "I'll give the 10.10.10.2 address to the home firewall:"
    },
    {
      "self_ref": "#/texts/22",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip address\nadd address=10.10.10.2/30 interface=home-to-colo network=10.10.10.0",
      "text": "/ip address\nadd address=10.10.10.2/30 interface=home-to-colo network=10.10.10.0",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/23",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "And I'll give the 10.10.10.1 address to the colo firewall:",
      "text": "And I'll give the 10.10.10.1 address to the colo firewall:"
    },
    {
      "self_ref": "#/texts/24",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip address\nadd address=10.10.10.1/30 interface=colo-to-home network=10.10.10.0",
      "text": "/ip address\nadd address=10.10.10.1/30 interface=colo-to-home network=10.10.10.0",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/25",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "At this point, systems at home can ping 10.10.10.1 (the colo router's GRE tunnel endpoint) and systems at the colo can ping 10.10.10.2 (the home router's GRE tunnel endpoint). That's great because we will use these IP's to route our LAN traffic across the tunnel.",
      "text": "At this point, systems at home can ping 10.10.10.1 (the colo router's GRE tunnel endpoint) and systems at the colo can ping 10.10.10.2 (the home router's GRE tunnel endpoint). That's great because we will use these IP's to route our LAN traffic across the tunnel."
    },
    {
      "self_ref": "#/texts/26",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We need to tell the home router how to get traffic from its LAN over to the colo LAN and vice versa. We can do that with the tunnel endpoints we just configured.",
      "text": "We need to tell the home router how to get traffic from its LAN over to the colo LAN and vice versa. We can do that with the tunnel endpoints we just configured."
    },
    {
      "self_ref": "#/texts/27",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Let's tell the home router to use the colo router's GRE tunnel endpoint to reach the colo LAN:",
      "text": "Let's tell the home router to use the colo router's GRE tunnel endpoint to reach the colo LAN:"
    },
    {
      "self_ref": "#/texts/28",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip route\nadd distance=1 dst-address=192.168.150.0/24 gateway=home-to-colo",
      "text": "/ip route\nadd distance=1 dst-address=192.168.150.0/24 gateway=home-to-colo",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/29",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "And tell the colo router to use the home router's GRE endpoint to reach the home LAN:",
      "text": "And tell the colo router to use the home router's GRE endpoint to reach the home LAN:"
    },
    {
      "self_ref": "#/texts/30",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip route\nadd distance=1 dst-address=192.168.50.0/24 gateway=colo-to-home",
      "text": "/ip route\nadd distance=1 dst-address=192.168.50.0/24 gateway=colo-to-home",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/31",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We don't have to tell the router about the tunnel's IP address since those routes are generated automatically when we added the IP addresses to each side of the GRE tunnel.",
      "text": "We don't have to tell the router about the tunnel's IP address since those routes are generated automatically when we added the IP addresses to each side of the GRE tunnel."
    },
    {
      "self_ref": "#/texts/32",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "If you've made it this far, systems in your home LAN should be able to ping the colo LAN and vice versa. If not, go back and double-check your IP addresses on both sides of the tunnel and your routes.",
      "text": "If you've made it this far, systems in your home LAN should be able to ping the colo LAN and vice versa. If not, go back and double-check your IP addresses on both sides of the tunnel and your routes."
    },
    {
      "self_ref": "#/texts/33",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "Adding IPSec",
      "text": "Adding IPSec",
      "level": 1
    },
    {
      "self_ref": "#/texts/34",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "BEFORE YOU GO ANY FURTHER, ensure you have some sort of out-of-band access to both routers.  If you make a big mistake like I did (more on that later), you're going to be glad you set up another way to reach your devices!",
      "text": "BEFORE YOU GO ANY FURTHER, ensure you have some sort of out-of-band access to both routers.  If you make a big mistake like I did (more on that later), you're going to be glad you set up another way to reach your devices!"
    },
    {
      "self_ref": "#/texts/35",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We have an GRE tunnel without encryption already and that's allowing us to pass traffic. That's fine, but it's not terribly secure to send our packets in that tunnel across a hostile internet. IPSec will allow us to tell both routers that we want packets between the public IP addresses of both routers to be encrypted. The GRE tunnel will take care of actually delivering the packets, however. IPSec isn't an interface and it can't be a conduit for networking all by itself.",
      "text": "We have an GRE tunnel without encryption already and that's allowing us to pass traffic. That's fine, but it's not terribly secure to send our packets in that tunnel across a hostile internet. IPSec will allow us to tell both routers that we want packets between the public IP addresses of both routers to be encrypted. The GRE tunnel will take care of actually delivering the packets, however. IPSec isn't an interface and it can't be a conduit for networking all by itself."
    },
    {
      "self_ref": "#/texts/36",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Have you configured another way to access both routers yet? Seriously, stop now and do that. I mean it.",
      "text": "Have you configured another way to access both routers yet? Seriously, stop now and do that. I mean it."
    },
    {
      "self_ref": "#/texts/37",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "If you have native IPv6 access (not a IPv6 over IPv4 tunnel!) into each device, that can be a viable backup plan. Another option might be serial cables or a dedicated console connection. You'll thank me later.",
      "text": "If you have native IPv6 access (not a IPv6 over IPv4 tunnel!) into each device, that can be a viable backup plan. Another option might be serial cables or a dedicated console connection. You'll thank me later."
    },
    {
      "self_ref": "#/texts/38",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Configuring IPSec is done in three chunks:",
      "text": "Configuring IPSec is done in three chunks:"
    },
    {
      "self_ref": "#/texts/39",
      "parent": {
        "$ref": "#/groups/1"
      },
      "children": [],
      "content_layer": "body",
      "label": "list_item",
      "prov": [],
      "orig": "Make a proposal: both routers must agree on how to authenticate each other and encrypt traffic",
      "text": "Make a proposal: both routers must agree on how to authenticate each other and encrypt traffic",
      "enumerated": false,
      "marker": "-"
    },
    {
      "self_ref": "#/texts/40",
      "parent": {
        "$ref": "#/groups/1"
      },
      "children": [],
      "content_layer": "body",
      "label": "list_item",
      "prov": [],
      "orig": "Configure a peer list: both routers need to know how to reach each other and have some shared secrets",
      "text": "Configure a peer list: both routers need to know how to reach each other and have some shared secrets",
      "enumerated": false,
      "marker": "-"
    },
    {
      "self_ref": "#/texts/41",
      "parent": {
        "$ref": "#/groups/1"
      },
      "children": [],
      "content_layer": "body",
      "label": "list_item",
      "prov": [],
      "orig": "Set a policy: both routers need to agree on which packets must be encrypted",
      "text": "Set a policy: both routers need to agree on which packets must be encrypted",
      "enumerated": false,
      "marker": "-"
    },
    {
      "self_ref": "#/texts/42",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We will start with the proposal. The defaults are good for both routers. Add this configuration  on both devices :",
      "text": "We will start with the proposal. The defaults are good for both routers. Add this configuration  on both devices :"
    },
    {
      "self_ref": "#/texts/43",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip ipsec proposal\nset [ find default=yes ] auth-algorithms=md5 enc-algorithms=aes-128-cbc,twofish",
      "text": "/ip ipsec proposal\nset [ find default=yes ] auth-algorithms=md5 enc-algorithms=aes-128-cbc,twofish",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/44",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Now our routers agree on what methods they'll use to encrypt traffic. Feel free to adjust these algorithms later if needed. Let's tell each router about its peer.",
      "text": "Now our routers agree on what methods they'll use to encrypt traffic. Feel free to adjust these algorithms later if needed. Let's tell each router about its peer."
    },
    {
      "self_ref": "#/texts/45",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "At home:",
      "text": "At home:"
    },
    {
      "self_ref": "#/texts/46",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip ipsec peer\nadd address=2.2.2.2/32 nat-traversal=no secret=letshavefunwithipsec",
      "text": "/ip ipsec peer\nadd address=2.2.2.2/32 nat-traversal=no secret=letshavefunwithipsec",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/47",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "At the colo:",
      "text": "At the colo:"
    },
    {
      "self_ref": "#/texts/48",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip ipsec peer\nadd address=1.1.1.1/32 nat-traversal=no secret=letshavefunwithipsec",
      "text": "/ip ipsec peer\nadd address=1.1.1.1/32 nat-traversal=no secret=letshavefunwithipsec",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/49",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Both routers now know about each other and they both have the same shared secret (please use a better shared secret in production). All we have left is configuring a policy.",
      "text": "Both routers now know about each other and they both have the same shared secret (please use a better shared secret in production). All we have left is configuring a policy."
    },
    {
      "self_ref": "#/texts/50",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "At this point, ensure you're accessing both routers via an out-of-band method (native IPv6, console, serial, etc).  YOU ARE ABOUT TO LOSE CONNECTIVITY TO YOUR REMOTE DEVICE.",
      "text": "At this point, ensure you're accessing both routers via an out-of-band method (native IPv6, console, serial, etc).  YOU ARE ABOUT TO LOSE CONNECTIVITY TO YOUR REMOTE DEVICE."
    },
    {
      "self_ref": "#/texts/51",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "At home, we set up a policy that says all traffic between the public addresses of both firewalls must be encrypted (GRE will carry the traffic for us).  Ensure that the CIDR portion of the IP address for dst-address/src-address is present!",
      "text": "At home, we set up a policy that says all traffic between the public addresses of both firewalls must be encrypted (GRE will carry the traffic for us).  Ensure that the CIDR portion of the IP address for dst-address/src-address is present!"
    },
    {
      "self_ref": "#/texts/52",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip ipsec policy\nadd dst-address=2.2.2.2/32 sa-dst-address=2.2.2.2 sa-src-address=1.1.1.1 src-address=1.1.1.1/32 tunnel=yes",
      "text": "/ip ipsec policy\nadd dst-address=2.2.2.2/32 sa-dst-address=2.2.2.2 sa-src-address=1.1.1.1 src-address=1.1.1.1/32 tunnel=yes",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/53",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "We will do something similar on the colo side.  Again, ensure that the CIDR portion of the IP address for dst-address/src-address is present!",
      "text": "We will do something similar on the colo side.  Again, ensure that the CIDR portion of the IP address for dst-address/src-address is present!"
    },
    {
      "self_ref": "#/texts/54",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/ip ipsec policy\nadd dst-address=1.1.1.1/32 sa-dst-address=1.1.1.1 sa-src-address=2.2.2.2 src-address=2.2.2.2/32 tunnel=yes",
      "text": "/ip ipsec policy\nadd dst-address=1.1.1.1/32 sa-dst-address=1.1.1.1 sa-src-address=2.2.2.2 src-address=2.2.2.2/32 tunnel=yes",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/55",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "You should now be able to ping across your GRE tunnel but it's encrypted this time! If you find that one of your devices is inaccessible, don't panic. Disable the policy you just added (",
      "text": "You should now be able to ping across your GRE tunnel but it's encrypted this time! If you find that one of your devices is inaccessible, don't panic. Disable the policy you just added ("
    },
    {
      "self_ref": "#/texts/56",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "set disabled=yes number=[number of your policy]",
      "text": "set disabled=yes number=[number of your policy]",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/57",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": ") and review your configuration.",
      "text": ") and review your configuration."
    },
    {
      "self_ref": "#/texts/58",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "In the policy step, we told both routers that if traffic moves between the  src-address  and  dst-address , we want it encrypted. Also, the  sa-src-address  and  sa-dst-address  gives the router a hint to figure out the identity of the peer and what their shared secret is.",
      "text": "In the policy step, we told both routers that if traffic moves between the  src-address  and  dst-address , we want it encrypted. Also, the  sa-src-address  and  sa-dst-address  gives the router a hint to figure out the identity of the peer and what their shared secret is."
    },
    {
      "self_ref": "#/texts/59",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "Checking our work",
      "text": "Checking our work",
      "level": 1
    },
    {
      "self_ref": "#/texts/60",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "You can check your work with something like this on the home router:",
      "text": "You can check your work with something like this on the home router:"
    },
    {
      "self_ref": "#/texts/61",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "[major@Home] > /ip ipsec remote-peers print\n 0 local-address=1.1.1.1 remote-address=2.2.2.2 state=established side=initiator established=7h17m10s",
      "text": "[major@Home] > /ip ipsec remote-peers print\n 0 local-address=1.1.1.1 remote-address=2.2.2.2 state=established side=initiator established=7h17m10s",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/62",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "If you have a line like that, your IPSec peers can communicate properly. To test the encryption, you have two options. One option is to put a device outside your firewall and dump traffic via a tap or hub.",
      "text": "If you have a line like that, your IPSec peers can communicate properly. To test the encryption, you have two options. One option is to put a device outside your firewall and dump traffic via a tap or hub."
    },
    {
      "self_ref": "#/texts/63",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Another option (albeit less accurate) is to use the profile tool built into RouterOS. Run the following:",
      "text": "Another option (albeit less accurate) is to use the profile tool built into RouterOS. Run the following:"
    },
    {
      "self_ref": "#/texts/64",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "code",
      "prov": [],
      "orig": "/tool profile",
      "text": "/tool profile",
      "captions": [],
      "references": [],
      "footnotes": [],
      "code_language": "unknown"
    },
    {
      "self_ref": "#/texts/65",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "You'll see some output showing where the majority of your CPU is consumed. Now, transfer some large files between systems behind both routers. You can use  iperf  for this as well if you really want to stress out the network link. When you do that, you should see  encrypting  in the profile output as a very large consumer of the CPU. If you only see something like  gre  or  ethernet  as your top CPU consumers, you may have missed something on your IPSec policy and your traffic is likely not being encrypted. This isn't true for all routers &#8212; it depends on your normal workloads.",
      "text": "You'll see some output showing where the majority of your CPU is consumed. Now, transfer some large files between systems behind both routers. You can use  iperf  for this as well if you really want to stress out the network link. When you do that, you should see  encrypting  in the profile output as a very large consumer of the CPU. If you only see something like  gre  or  ethernet  as your top CPU consumers, you may have missed something on your IPSec policy and your traffic is likely not being encrypted. This isn't true for all routers &#8212; it depends on your normal workloads."
    },
    {
      "self_ref": "#/texts/66",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "section_header",
      "prov": [],
      "orig": "How I made a huge mistake",
      "text": "How I made a huge mistake",
      "level": 1
    },
    {
      "self_ref": "#/texts/67",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "When I was going through this process, I made it through the GRE portion without a hitch. Everything worked well. Once I added IPSec to the mix, I used the GRE tunnel endpoints (10.10.10.1 and 10.10.10.2) as my  src-address  and  dst-address  in my IPSec policy. Nothing was getting encrypted and I was getting really frustrated.",
      "text": "When I was going through this process, I made it through the GRE portion without a hitch. Everything worked well. Once I added IPSec to the mix, I used the GRE tunnel endpoints (10.10.10.1 and 10.10.10.2) as my  src-address  and  dst-address  in my IPSec policy. Nothing was getting encrypted and I was getting really frustrated."
    },
    {
      "self_ref": "#/texts/68",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I kept reading tutorials on various sites and came to realize that I didn't need an encryption policy between the tunnel endpoints, I needed a policy between the actual public addresses of the routers. I wasn't aware that the GRE tunnel would happily keep working between the two public IP addresses even with the IPSec policy in place between the IP addresses.",
      "text": "I kept reading tutorials on various sites and came to realize that I didn't need an encryption policy between the tunnel endpoints, I needed a policy between the actual public addresses of the routers. I wasn't aware that the GRE tunnel would happily keep working between the two public IP addresses even with the IPSec policy in place between the IP addresses."
    },
    {
      "self_ref": "#/texts/69",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "First mistake: I didn't access my colo router via an out-of-band path. Second mistake: I applied my IPSec policy on the home router first and was shocked that I lost connectivity to the colo router. That was a quick fix &#8212; I just disabled the IPSec policy on the home router and I could access the colo router again.",
      "text": "First mistake: I didn't access my colo router via an out-of-band path. Second mistake: I applied my IPSec policy on the home router first and was shocked that I lost connectivity to the colo router. That was a quick fix &#8212; I just disabled the IPSec policy on the home router and I could access the colo router again."
    },
    {
      "self_ref": "#/texts/70",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Just after adjusting the IPSec policy on the colo router to use the public IP addresses, I noticed that connectivity dropped. At this point, I expected that &#8212; I set up a policy there but I hadn't done it on the home router yet. I enabled the policy on the home router and then started pinging. Nothing.",
      "text": "Just after adjusting the IPSec policy on the colo router to use the public IP addresses, I noticed that connectivity dropped. At this point, I expected that &#8212; I set up a policy there but I hadn't done it on the home router yet. I enabled the policy on the home router and then started pinging. Nothing."
    },
    {
      "self_ref": "#/texts/71",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Then came the Pingdom and UptimeRobot alerts for my sites in the colo.  Oh crap.",
      "text": "Then came the Pingdom and UptimeRobot alerts for my sites in the colo.  Oh crap."
    },
    {
      "self_ref": "#/texts/72",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "5",
      "text": "5"
    },
    {
      "self_ref": "#/texts/73",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Once I was able to reach the colo router via IPv6 through some other VM's, I realized what happened. I left the CIDR mask off the  src-address  and  dst-address  in the IPSec policy.",
      "text": "Once I was able to reach the colo router via IPv6 through some other VM's, I realized what happened. I left the CIDR mask off the  src-address  and  dst-address  in the IPSec policy."
    },
    {
      "self_ref": "#/texts/74",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "Guess what RouterOS chose as a CIDR mask for me?  /0.  Ouch.",
      "text": "Guess what RouterOS chose as a CIDR mask for me?  /0.  Ouch."
    },
    {
      "self_ref": "#/texts/75",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "paragraph",
      "prov": [],
      "orig": "I quickly adjusted those to be /32's. Within seconds, everything was up again and the GRE tunnel began working. As the Pingdom alerts cleared and my heart rate returned to normal, I figured the best thing I should do is share my story so that others don't make the same mistake. ;)",
      "text": "I quickly adjusted those to be /32's. Within seconds, everything was up again and the GRE tunnel began working. As the Pingdom alerts cleared and my heart rate returned to normal, I figured the best thing I should do is share my story so that others don't make the same mistake. ;)"
    }
  ],
  "pictures": [
    {
      "self_ref": "#/pictures/0",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "picture",
      "prov": [],
      "captions": [],
      "references": [],
      "footnotes": [],
      "annotations": []
    },
    {
      "self_ref": "#/pictures/1",
      "parent": {
        "$ref": "#/body"
      },
      "children": [],
      "content_layer": "body",
      "label": "picture",
      "prov": [],
      "captions": [],
      "references": [],
      "footnotes": [],
      "annotations": []
    }
  ],
  "tables": [],
  "key_value_items": [],
  "form_items": [],
  "pages": {}
}